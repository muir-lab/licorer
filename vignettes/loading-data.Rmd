---
title: "Reading raw LI-6800 files into R"
author: "Daniel Trupp"
date: "June 23, 2020"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{loading-data}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding[UTF-8]{inputenc}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

The **licorer** package streamlines reading and validating data from raw LI-6800 files in *R*. To read a raw LI-6800 data file, use the `licor()` method. This will create a `licor` object, which stores the data in a tibble data object with header data stored in attributes.  


```{r setup}
library(licorer)
library(units)
library(stringr)
library(knitr)
library(kableExtra)

# CDM: is this the only way to access data. What about the utils::data() function rather than system.file()?
test_data <- licor(system.file("extdata", "2019-05-06-0740_trillium_ovatum", 
                               package = "licorer", mustWork = TRUE))

```

```{r, eval = FALSE}
test_data <- read_li6800_raw(system.file("extdata", "2019-05-06-0740_trillium_ovatum", 
                                         package = "licorer", mustWork = TRUE))
```

```{r, eval = TRUE, echo = FALSE}
# CDM: You can also hide some code yet still execute it. Users don't really need to see code to make the table output

# CDM: It also occurred to me that vignettes are usually available both as HTML and PDF. What does scroll_box() do in PDF?
# DT: It looks like it loads in the help window as well. 

scroll_box(knitr::kable(test_data, caption = "Example"),
            height = "250px", width = "700px", 
            box_css = "border: 1px solid #ddd; padding: 5px; ", 
            extra_css = NULL, fixed_thead = TRUE)
```

### The Data

As you can see, there is a lot of data. There are `r nrow(test_data)` rows and `r ncol(test_data)` columns. 

All of the data is stored either as a unit (some have the "unitless" unit) or as an approprate class (character, hms, or date/time), which are automatically assigned and validated when the file is loaded, as they are read in from the file. We'll discuss user-defined variables below.

LI-COR groups variables into a few different categories which are stored as attributes of the data. This topic is covered in greater detail in the vignette on [data manipulation](data-manipulation.html) and by the `subset_options()` function described below.

```{r}
subset_options(test_data)
```

The data columns covered by each of these values are expressly stated in the LI-6800 manual "Summary of symbols" section (CDM: provide page # and edition, v1.4 in this case).  

### The Header

In addition to data, the `licor` class stores meta-data from the header of the LI-6800 data file. This information is accessible with the `header` attribute.

```{r}
attributes(test_data)$header[1:5]
```

Once again we are showing a subset of the list, as the actual list of meta-data
contains around 50 elements. 


The `licor_validator()` that ensures that the `licor` class was created correctly and that all variables have valid scientific units. It is automatically called during the `licor` method call, but not during the `read_li6800_raw()` method.

Currently, the data reader only supports reading from LI-6800 files, but we 
plan to add support for the LI-6400 as well.


The `read_li6400_raw()` and it's companion `read_li6400()` are automatically called instead of the 6800 method from within `licor()` but operate a bit differently from the `read_li6800()` function. The li-Cor 6800 files come with extra, useful information like units and the system that recorded the data (ex. GasEx), which the 6400 data files do not have. The system is set by the function, based off the 6800's systems, and the units are based off the expected units for each variable. If the units for your 6400 file differ from the default units, override them with the `expected_units_6400` file.
